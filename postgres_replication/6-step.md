[На главную](./index.md) | [Предыдущий шаг](5-step.md)

# Slave -> Master -> Slave. Отработка ситуации, когда чудесным образом удалось восстановить **a_server** и необходимо всё вернуть на круги своя

_! Представим ситуацию, когда наш первоначальный slave сервер был переведен в мастера и теперь нам необходимо slave сделать сново slave-ом а мастера мастером_

---

0. Слэйв у нас сейчас - это мастер
1. Делаем pg_basebackup у старого мастер базы. И тогда она становится слэйвом
2. Делаем pg_ctl promote. Мастер становится мастером
3. Деламе pg_basebackup у на сервере с первоначальным slave

---

Всё что ниже не протестированно и скорее всего работать не будет

Переходи на сервер с базой, которую нужно сделать мастером и выполняем процедуру сначала настраиваем его как slave сервер:

1. [Настройка репликации **pg_one_master** в базу **pg_one_slave** на **b-server**](3-step.md)
2. Нужно поменять папку archive
3. Выполняем команду для смена мастера на слэйва и обратно:

```
su postgres
```

```
pg_rewind -D /media/vault.sql/one --source-server="host=10.10.10.10 port=5433 user=postgres" -P -R
```
