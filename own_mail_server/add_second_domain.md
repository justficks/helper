## Настройка dns записей для второго домена к существующему почтовому серверу

Введение:

- У нас имеется запущенный почтовый сервер на домене domain1.org
- Почтовые клиенты подключаются к нему через mail.domain1.org
- **У нас появился второй домен, который тоже требует возможности получения и отправки писем на домене domain2.com**

Задача:

- Настроить второй домен (domain2.com) к нашему почтовому серверу на domain1.org

---

- Для начала нужно получить и настроить DKIM для нового домена.
  Идем на сервер и запускаем команду генерации DKIM:

```
docker exec mailserver setup config dkim keysize 4096 domain domain2.com
```

- В папке .../dms/config/opendkim/keys/ появиться папка domain2.com

- Содержимое файла .../dms/config/opendkim/keys/domain2.com/mail.txt нам понадобиться для настроек dns записей в cloudflare

- Заходим в cloudflare -> Настройка DNS записей

- Добавляем следующие записи:

  - MX @ mail.domain1.org Priority = 10
  - TXT \_dmarc "v=DMARC1; p=reject; rua=mailto:adm@domain1.org"
  - TXT @ "v=spf1 mx -all"

- И ещё одну TXT запись с именем mail.\_domainkey и контентом из файла о котором писали выше, примерно в таком виде: "v=DKIM1; h=sha256; k=rsa; p=MI....=="

- На этом всё. Создаете почтовый адрес и проверяете прием и отправку писем
